---
title: C++教學
description: C++基礎教學
tags: Tutorial
lang: zh-tw
breaks: false
---

# 前言

C\+\+是一門古老的程式語言，但其歷久不衰，有著強大的功能。
本教學將介紹「現代C\+\+」，這是指C++11及其之後的標準。作為對比，我們將之前的標準稱作「古典C\+\+」。

在學習現代C\+\+時，不能把它當作「多了class的C」，事實上，如今C\+\+和C間已經有巨大的差異，C並不是C\+\+的子集。
除了歷史的淵源，甚至可以說它們就像Java和Javascript一樣不相關。

## 適合誰

無論你已經掌握其他語言，抑或剛接觸程式設計，本教學都適合你，這是為C\+\+新手所打造的。

## 如何閱讀

本教學預期你是從頭到尾按照順序閱讀，後面的概念會建立在前面的基礎上。

「可跳過的細節」區塊並不建議在剛開始閱讀，可以在讀完整份教學後，再回來看看。

# 入門

C\+\+是一種預先編譯的語言，這表示你必須先把你的程式碼（原始碼）*編譯*成執行檔。如此一來，若你想要分享你的程式，可以直接發送執行檔而不是要求其他人安裝執行環境（例如Python）。

這個章節中，我們將討論如何安裝必要的工具，以及撰寫第一個程式。

## 安裝

為了撰寫程式，你至少需要：

- 編輯器
- 編譯器

如果你正在進行一個大型專案，你甚至需要更多工具！（當然你也可以靠自己的大腦）

編輯器就是任何可以編輯檔案的應用程式，例如記事本；編譯器則是「將原始碼翻譯成電腦可以執行的0和1」的程式。

所以，你可以使用Windows的記事本來寫程式，但那很不方便，因此開發者通常會使用整合開發環境（integrated development environment，IDE），一個好的IDE甚至可以讓你開發得更有效率。
我推薦使用JetBrains的[CLion](https://www.jetbrains.com/clion/)[^CLion]，但你也可以使用其他的，像Microsoft Visual Studio等。

IDE通常有許多強大的功能，那不是我們要討論的。
因此，這裡將（假設你）使用一個普通的文字編輯器和終端來手動編譯，當然你也可以使用IDE直接透過GUI操作，通常可以在他們的網站上找到教學。

CLion允許你選擇想要的編譯器實現，Windows中可以安裝[clang](https://github.com/llvm/llvm-project/releases)，Linux則可以使用[g++](https://gcc.gnu.org/)。
安裝完成後，打開CLion的設定頁面，如果toolchain沒有自動偵測到，請手動指定。

## 程式進入點

要定義一個函式（function），包含四個部分：回傳型別（return type）、名稱（name）、參數（parameter）、主體（body）。
這裡的函式比起數學上的函數，稱作子程式可能更爲恰當，你可以傳入引數（argument）來呼叫函式，並得到回傳值，但有時更重要的是函式的副作用（side effect），這也是函式與數學函數最大的差異；例如我們常常要在螢幕上顯示文字，那就可以把這個動作寫成一個函式，傳入要顯示的文字，如此一來就只要呼叫這個函式就好，而這個函式的回傳並不那麼重要，它不計算什麼值。

進入點（entry point）是一個會在程式執行時，被系統呼叫的函式。在C\+\+中這個函式是一個名稱為`main`，會回傳一個`int`，也就是整數的函式。
這個整數會回傳給函式的呼叫者——系統，通常以0表示程式成功執行完畢，其他數值的含義則由系統決定。

所以，下面的範例是一個程式的進入點，作為一個函式，有回傳型別`int`、名稱`main`、參數（不接收參數），以及主體。
主體以花括號包裹，裡面則是多個述句（statement）。
範例中只有一個述句：`return 0;`，也就是回傳`0`。

```cpp=
int main() {
    return 0;
}
```

## 編譯並執行

打開文字編輯器，輸入上面的程式碼（未編譯的程式通常稱作原始碼（source code））並儲存成`main.cpp`。然後打開終端（像Windows的Power Shell），輸入：

```shell=
g++ main.cpp -o main
./main
```

注意指令會隨著shell和編譯器不同，請使用`--help`檢查使用方式。

## Hello World

```cpp=
#include <iostream>

int main() {
    std::cout << "Hello World!";
    
    return 0;
}
```

前置處理器會在編譯之前處理前置處理指令（preprocessor directive），也就是井號開頭的行。
`#include`指令能要求前置處理器找到指定的檔案，然後把裡面的內容貼上到你的檔案。
這裡，我們include了C\+\+標準庫中的`iostream`，這個檔案裡有一些輸出輸入相關的東西。

`std`是一個命名空間，標準庫的東西都在這個命名空間中，如此一來就可以防止「撞名」。
例如假如有兩個地方都叫紐約，說「美國，紐約」就可以知道是哪個紐約了。
`::`這個運算子能夠從命名空間中取得東西，所以`std::cout`就是「`std`裡的`cout`」的意思。

`cout`是character output，是標準輸出輸出流（standard output stream），通常會輸出到終端。

如果你會其他語言的話，或許會覺得`<<`很怪，那看起來是個位元左移運算子。
事實上，那是多載過的運算子，運算子就只是個函式，但讓程式碼更清楚（例如可以使用`one < another`而不用像`one.isLessThan(another)`這樣）。
在這裡，`<<`是「流出」，它將右方的值放到左方的流中。

而`"Hello World!"`是一個字串字面值（literal）。
在C\+\+中，字串必須使用雙引號包裹。

# 變數

當需要儲存一個值時，可以使用變數（variable）。
對於大多數如C\+\+一樣的命令式語言來說，變數和數學上的變數並不一樣，更像是一個在代表記憶體上特定的空間的名字。
最大的差異便是它是可變的（mutable）。

```cpp=
int variable = 0;
```

要定義一個變數只要寫出它的型別和名稱就好，然而在沒有給定初始值的情況下，讀取這個變數的值是UB（undefined behavior，未定義行為），因為你只是分配了一塊記憶體給變數，嘗試讀取只會得到記憶體垃圾。

## 常量

如果不希望變數的值被更改，可以使用`const`關鍵字來定義一個不可變的變數（immutable variable）。

```cpp=
const int variable = 10;

// variable = 20; // ERROR!
```

## 基礎型別

以下是C\++中目前的基礎型別（省略了部分避免混淆）：

|     型別      |         名稱         |
|:-------------:|:--------------------:|
|    `void`     | 空型別（不完整型別） |
|    `bool`     |        布林值        |
|     `int`     |         整數         |
|    `char`     |         字元         |
|    `float`    |     單精度浮點數     |
|   `double`    |     雙精度浮點數     |
| `long double` |    擴展精度浮點數    |

`void`是一個「沒有值」的型別，可以當作回傳型別，表示沒有回傳值。
在Microsoft Visual Studio的編譯器實作中允許main函式沒有回傳值，然而這並不是一個好的做法，因為這樣的程式碼沒有共通性。

布林值是只有`true`和`false`的型別。

`int`可以使用`signed`（預設即為有號，省略）、`unsigned`、`short`、`long`修飾。
使用時，`int`可以省略，且任何順序皆可被接受（但不建議用非正常的順序）。
以下是各種整數型別的大小（位元）：

|    型別     |  大小  |
|:-----------:|:------:|
|   `short`   | 至少16 |
|    `int`    | 至少16 |
|   `long`    | 至少32 |
| `long long` | 至少64 |

浮點數和一般認知的「小數」並不一樣，它是以二進位方式儲存近似值，因此存在誤差不能拿來計算金錢等資料。

:::spoiler 可跳過的細節
剛剛的表格省略了：

|       型別       |      名稱      |
|:----------------:|:--------------:|
| `std::nullptr_t` |   空指標型別   |
|    `wchar_t`     |     寬字元     |
|    `char8_t`     | UTF-8編碼單元  |
|    `char16_t`    | UTF-16編碼單元 |
|    `char32_t`    | UTF-32編碼單元 |

`sizeof(char)`保證為1，其他整數型別依次更大或相等。
因此在所有整數型別都為（至少）64位元的極端情況，`sizeof`都將回傳1。

`std::nullptr_t`即`decltype(nullptr)`，能夠隱式轉換至各種指標型別。

`wchar_t`能夠容納任何支援的字元編碼的碼點，例如在支援Unicode的機器上是32位元（但在Windows是16位元，使用UTF-16編碼，類似Java的`char`，需使用代理對表示使用了更多位元組的碼點的字元）。
:::

### 字面值

字面值，也就是直接「寫死」在程式碼中的值。

可以使用`1s`、`1L`等來表示不同長度的整數的字面值，而加上小數點後如`1.`、`3.14`就會是`double`，`float`型別可以使用後綴`f`如`3.14f`。

### 字元與字串

在C\+\+中其實並沒有「字串」型別，雙引號包裹的字串字面值的型別是`const char[]`，也就是字元陣列，並總是以空字元（`'\0'`）標誌字串的結束。

在字元或字串的字面值中，可以使用反斜線開頭的跳脫序列（escape sequence）來表示如換行等字元。

|   跳脫序列   | 字元                       |
|:------------:| -------------------------- |
|     `\'`     | 單引號（single quote）     |
|     `\"`     | 雙引號（double quote）     |
|     `\?`     | 問號（question mark）      |
|     `\\`     | 反斜線（backslash）        |
|     `\a`     | 響鈴（audible bell）       |
|     `\b`     | 退格（backspace）          |
|     `\f`     | 換頁（form feed）          |
|     `\n`     | 換行（line feed）          |
|     `\r`     | 回車（carriage return）    |
|     `\t`     | 水平製表（horizontal tab） |
|     `\v`     | 垂直製表（vertical tab）   |
|    `\000`    | 位元組`000`（八進位）      |
|    `\x00`    | 位元組`00`（十六進位）     |
|   `\u0000`   | Unicode碼點`U+0000`        |
| `\U00000000` | Unicode碼點`U+00000000`    |

---

版權所有 (c) 2022 Luminous-Coder  
所有內容在 [CC「姓名標示—非商業性—禁止改作」4.0 國際公眾授權條款](https://creativecommons.org/licenses/by-nc-nd/4.0/legalcode.zh-Hant) 下提供。

{%hackmd Wd1xvc_AQuSzWZPcQXSn3Q %}

[^CLion]: CLion需要付費，但如果你是學生便可以申請教育方案，免費使用JetBrains的各種IDE。